const words =  ["hitch","dirty","soapy","pivot","pique","sheik","croup","lying","furry","patch","toddy","ranch","tying","bevel","inlet","hoist","spent","abyss","ensue","windy","greet","mound","diode","midge","sower","nomad","unfit","blitz","lanky","march","tabby","dunce","rarer","flake","debit","dutch","lipid","bribe","brute","sleet","eclat","sooth","shoot","fuzzy","tumor","grasp","gnash","rinse","prose","serum","prime","mount","geeky","yacht","oxide","medic","sonic","grade","ready","comfy","frown","water","carol","curry","slack","louse","irate","wispy","freer","spelt","ghoul","whoop","scion","plier","plead","aunty","sewer","vowel","sense","speak","nadir","usurp","trade","jewel","quite","fight","sorry","front","binge","choir","faint","style","spend","laden","teary","peach","barge","track","credo","train","eject","stalk","aider","plaza","chose","order","gayer","growl","kneed","camel","twirl","frost","begat","sweat","beset","glove","fetal","gripe","staff","bingo","smelt","loyal","ankle","trite","clump","crush","coyly","hello","crock","bison","shalt","heave","winch","belch","apart","cairn","brake","fiend","south","smirk","inbox","alone","grill","moose","penal","snore","began","grout","nylon","leave","quiet","crest","timer","mucky","harry","sheet","third","labor","crave","medal","lemur","mercy","drake","sleek","whale","sting","chest","stead","snail","rigid","dirge","entry","abbey","taint","first","recur","fetus","brand","trunk","bland","black","whole","edify","built","nutty","gauge","awful","shape","erect","surer","shook","briar","royal","spiky","chaff","award","sauna","viral","lathe","guile","flier","basis","foggy","dodgy","moult","honey","filly","marry","batty","blood","input","sniff","elder","glyph","heist","dodge","agony","guild","skiff","prune","brook","quirk","mocha","plate","stand","doing","buggy","modal","lunar","swear","utter","often","scrub","climb","bunny","bleep","shout","sugar","vocal","angst","farce","demur","flack","wagon","chalk","knave","wafer","virus","elite","maple","prowl","marsh","deity","siren","gruel","baggy","wrath","poser","curve","fjord","snaky","braid","slept","shade","ratio","otter","roach","prism","solve","annul","fluid","skier","batch","piper","inept","graph","dolly","shawl","prude","horde","folly","frank","slate","havoc","flown","plied","amuse","canoe","surge","reedy","tweak","trail","modem","visor","gulch","spurt","downy","smack","slurp","burly","pasta","horse","adopt","cacti","carry","pitch","amity","aroma","pudgy","whiny","alert","cross","borne","randy","fizzy","joint","girth","those","earth","dread","sport","adobe","surly","wrack","sally","tawny","squib","ivory","proud","lusty","recap","trump","funny","known","viper","churn","slash","gumbo","tonic","probe","ovate","scoop","skimp","lurid","zesty","civil","tepee","blurt","shame","moldy","navel","gully","posse","harem","dried","awake","hurry","harpy","aging","basil","coast","rajah","mogul","gecko","giver","tonal","privy","grave","waive","spawn","tough","dimly","circa","pecan","venom","nasty","swamp","folio","screw","cacao","suave","found","drawn","pouch","hussy","dowel","butte","macho","women","whiff","lithe","psalm","olden","theft","brunt","prong","goner","wince","drove","liver","teeth","chess","fugue","krill","aloft","lingo","adore","steal","urine","amend","snowy","rotor","crown","assay","lumpy","arson","sweep","sulky","devil","group","spore","flute","scant","kappa","truce","quilt","broke","exist","blade","creak","drill","wryly","staid","shirt","spied","glade","sheen","spoon","false","mural","dough","cover","hairy","basin","waxen","foist","flesh","tread","gooey","stoic","skunk","berth","dozen","gassy","flume","axiom","sissy","caulk","image","nicer","crack","micro","draft","tardy","morph","cycle","recut","wordy","tacit","crank","abide","swami","bosom","comma","cleft","aglow","fiery","frame","relax","wreak","opium","rhyme","glory","doubt","trial","crook","saner","defer","purge","tatty","stall","blurb","pooch","cache","annex","share","lowly","aorta","rover","visit","crepe","nurse","exert","macaw","embed","woken","swell","grope","alarm","great","cedar","crust","spiel","fresh","fauna","abase","stern","sprig","tacky","nerdy","erase","judge","perch","allot","twang","mauve","mirth","panel","thumb","lousy","toxic","glass","denim","stout","money","punch","manor","swore","spark","mower","jiffy","bible","jolly","overt","muddy","offal","squat","lilac","awash","paste","chute","kebab","crony","slink","munch","elect","slide","shyly","coach","buddy","ditto","olive","cabby","woody","flask","motel","owing","guise","decay","stove","craft","valor","adapt","fixer","leggy","thank","lucky","curvy","scram","salty","hedge","llama","arose","forth","atoll","crash","serve","parka","bossy","charm","equal","omega","vapid","toxin","axion","blink","exult","filer","swift","bonus","lance","being","sneak","skate","wield","berry","aptly","feast","owner","puppy","again","goofy","droll","trait","story","exalt","piety","hinge","latch","idiom","table","react","minus","evade","white","fried","maize","photo","shock","swish","tenet","flaky","fishy","plaid","creek","whose","alloy","newer","voice","array","wrong","gland","radii","bully","quoth","dowry","begun","picky","allay","skirt","cough","arise","duchy","treat","valid","eager","flood","spurn","feign","bilge","mouth","dusty","voter","forum","elope","light","leech","price","pinch","aware","lynch","rouse","amiss","tramp","speed","macro","refit","rumor","vista","toast","avert","occur","flour","clout","metro","gourd","crawl","groom","terse","roger","hater","mince","cynic","piggy","delve","diner","hazel","yeast","pixie","bused","vapor","exact","clank","fancy","augur","molar","setup","dress","nymph","young","smote","would","leapt","scamp","rebel","ovine","stuff","filth","knoll","pride","stilt","femur","scarf","crazy","crump","puffy","union","dense","focal","touch","lunge","voila","stone","drown","truss","chart","admin","flame","aphid","ninth","cocoa","crude","along","foray","spice","align","gleam","bigot","booze","vicar","digit","octal","flung","flyer","wheat","basal","pixel","fewer","plush","quick","poise","layer","ombre","scary","avian","husky","gamut","towel","hydro","smoke","honor","quash","crimp","dogma","ulcer","stood","baton","stage","swing","super","revel","magma","thong","curly","rural","condo","spine","humor","axial","gouge","salvo","stink","happy","loose","horny","title","paper","weave","ovary","truly","spiny","octet","inert","daddy","plank","piney","index","blare","tenth","warty","clash","verse","allow","ample","ruder","chuck","lease","topaz","chief","ninny","endow","hoard","shaft","clang","wring","scree","dryer","copse","halve","loath","wrest","spilt","tapir","egret","beach","spare","bugle","which","cabal","tryst","drive","rogue","torso","flail","hobby","scale","cream","conch","hence","forge","blown","strap","bleak","ralph","proof","impel","siege","chick","grove","holly","lower","rouge","spade","heavy","decor","goody","relic","jazzy","harsh","bloat","poesy","amply","hovel","crime","flick","trope","gawky","fully","nosey","neigh","rusty","stuck","reuse","witch","lobby","skulk","boost","niece","porch","truer","flunk","heard","learn","mambo","mamma","court","robin","joker","maybe","poppy","queer","baste","liege","short","humus","preen","gazer","cramp","talon","chain","dully","adult","graze","corer","river","intro","stack","theme","force","afire","mossy","cagey","thrum","snake","until","maxim","spear","reach","sinew","inter","tipsy","verve","pesto","slope","teddy","match","evoke","knock","idiot","leaky","shore","udder","libel","cruel","apply","pupal","drank","bluer","notch","brash","skill","crate","float","aloof","chase","prick","amber","wench","belly","click","scorn","choke","beast","pence","canny","guest","start","livid","snide","going","logic","debar","store","banal","shone","slick","lodge","valve","under","dross","mourn","cleat","taboo","steel","party","scaly","risky","quill","rapid","vague","ebony","bicep","early","human","bawdy","enjoy","syrup","total","ladle","chill","wheel","woman","sigma","depot","bushy","gusto","slave","noise","groin","stash","china","bongo","upset","range","melon","night","mouse","curse","tight","steer","other","trove","aback","crisp","dingy","drone","could","enact","candy","parse","shear","soggy","quest","spoil","thump","bagel","slung","tease","shave","odder","masse","crowd","tilde","smock","strut","wager","donut","savor","pulpy","rayon","frail","sixth","haven","grimy","glaze","quasi","bathe","undue","elfin","sooty","peace","onion","bezel","vital","comet","relay","primo","trout","ennui","amble","debut","plunk","snipe","avail","sumac","drunk","brush","study","lasso","pause","shell","leafy","score","unzip","cheek","ramen","druid","stein","pleat","thief","swept","trice","habit","cadet","snare","bench","token","decoy","craze","query","badge","hover","cliff","musty","kinky","steep","slice","tower","patsy","shush","boney","taste","pygmy","abort","idyll","fluke","troll","teach","hyper","paler","cutie","depth","check","focus","hyena","shrew","hotel","alive","lemon","blush","haunt","shank","tweed","weird","tried","epoch","pinky","sixty","meant","block","deuce","afoot","icily","deign","fault","snuck","fetid","right","daunt","bring","straw","armor","disco","pubic","askew","retch","shrug","cobra","pesky","tubal","quail","booty","tenor","grief","actor","maker","ashen","field","wedge","unfed","gonad","botch","adorn","brick","level","chide","bobby","breed","missy","purer","unity","brawl","erode","giddy","cater","fussy","alike","lofty","fritz","dealt","scene","grime","incur","bravo","brawn","razor","salad","loopy","vogue","sushi","slimy","clued","corny","tract","miser","worth","tepid","spite","fibre","gamer","broil","cried","befit","flora","anger","butch","juror","arena","arbor","fecal","juice","class","trawl","twist","genre","agree","scuba","champ","nudge","clung","ninja","hippy","gross","resin","broom","buyer","floor","spoke","beget","lapel","chump","timid","glide","genie","renal","sever","rider","liken","sully","cumin","empty","hunky","login","satyr","zonal","steed","cello","shelf","oaken","amaze","godly","anvil","khaki","tutor","aloud","lumen","tribe","spout","cubic","dusky","fairy","sheep","worry","roost","while","roomy","gaunt","slain","ratty","scope","epoxy","weary","steak","opine","hippo","hutch","width","scone","cloth","deter","sound","realm","stark","eerie","repel","canon","month","nobly","unlit","elegy","swung","whirl","fifty","radio","proxy","shaky","leash","where","rebus","friar","altar","prove","truth","mealy","payee","older","about","seedy","jumbo","today","exile","forty","prank","finer","think","drape","inlay","beard","pouty","miner","prone","drift","daily","dopey","shale","boxer","plump","fella","hatch","dryly","pizza","paddy","abled","event","split","mucus","excel","waltz","chaos","funky","buxom","freed","coral","bulky","write","whisk","snack","error","ultra","cloak","newly","couch","clear","satin","sober","pilot","youth","among","dying","legal","brass","bless","scold","fetch","cloud","pupil","later","faith","fatal","drool","trace","world","iliac","stump","zebra","urban","guilt","salve","alien","ingot","audio","outer","briny","ethos","fraud","crumb","weigh","place","reply","shrub","bacon","carve","angry","noble","clamp","curio","shown","demon","payer","there","north","quell","blind","jerky","shorn","nanny","seven","daisy","threw","gaudy","chime","sedan","scald","gayly","afoul","chock","kiosk","coven","dizzy","apple","theta","verge","spank","gamma","gypsy","slush","rodeo","cabin","email","laugh","eaten","cheer","gummy","polar","rally","plain","mushy","jaunt","glare","cluck","merit","repay","rival","murky","ledge","totem","pried","rumba","dingo","delay","abuse","borax","ahead","lurch","thing","chasm","idler","bluff","covey","vomit","clasp","mange","angle","evict","catty","motif","bulge","shine","clone","scoff","bride","furor","point","junto","bloke","blond","brine","round","petty","tarot","sadly","rhino","grand","tooth","tiger","sassy","adage","slime","rebar","witty","hotly","gauze","bowel","ethic","stare","silly","fence","eking","emcee","uncle","broad","shuck","ounce","detox","flirt","civic","suing","shake","plume","matey","lever","pulse","smear","leery","easel","fungi","onset","mimic","sling","chirp","apron","knack","coupe","latte","dumpy","geese","tweet","route","dwelt","minor","rerun","dwarf","panic","tidal","humph","pound","woozy","shove","stain","bitty","tamer","guard","umbra","sword","heath","taunt","eying","chili","acute","diary","optic","widen","infer","stole","semen","guava","pagan","decry","ether","minim","dowdy","anode","knead","greed","cheap","delta","album","ozone","sperm","froze","karma","abode","trust","biddy","wooly","scent","abbot","diver","using","taffy","stale","dairy","musky","retry","mulch","unmet","rehab","patio","label","stake","worse","rabid","smell","artsy","agile","thorn","femme","edict","shirk","balmy","baron","wharf","shied","serif","swarm","quark","raise","alley","billy","worst","suite","whack","music","snort","acrid","shard","baker","scrap","ghost","welch","agora","haute","ripen","dance","terra","nerve","jelly","bylaw","vixen","spell","gusty","rivet","slunk","willy","wrist","clown","catch","duvet","villa","vouch","knelt","belle","dummy","prior","sloop","rearm","stair","grain","smith","clerk","brown","finch","chant","snarl","tunic","vaunt","abhor","chunk","derby","spike","myrrh","brink","gorge","refer","savvy","rugby","loamy","seize","ditty","elbow","solar","radar","grail","vault","blimp","drain","oddly","flash","hound","wound","caper","sweet","lover","shire","stock","untie","beech","awoke","moist","saute","burst","limit","bloom","child","ember","amass","smash","golem","swash","swill","eight","leant","drink","board","inner","chard","joist","quart","sharp","inane","droit","fable","grate","mummy","hardy","parry","skull","anime","algae","stint","gaily","enema","debug","rocky","build","flush","glint","hilly","sauce","locus","papal","humid","squad","begin","heron","salon","tripe","yearn","sappy","mangy","twine","gavel","naive","smart","moral","extol","plant","pansy","lunch","scout","rupee","claim","queue","felon","drama","pinto","offer","bunch","swine","await","betel","sleep","eater","fever","floss","blast","titan","tiara","brain","larva","boast","piano","bough","pedal","large","valet","erupt","icing","attic","glean","troop","every","regal","smoky","haste","annoy","gnome","forte","drier","viola","yield","naval","alibi","sheer","after","fifth","cargo","outgo","storm","aping","tonga","novel","below","reset","stunt","spicy","scare","comic","vying","spasm","woven","basic","crass","cavil","ascot","spray","boozy","igloo","wrote","beady","turbo","putty","grunt","drawl","small","taper","smile","agate","croak","segue","brief","robot","stung","expel","spunk","sieve","agent","hymen","carat","badly","never","stony","riper","stoke","alpha","rough","swoop","rower","brace","media","audit","stomp","riser","torch","shack","organ","their","slant","wacky","sloth","covet","issue","eagle","salsa","angel","posit","usher","sepia","ficus","snout","mammy","these","stamp","imbue","torus","kneel","twice","shall","bliss","vigor","grape","minty","elude","aisle","perky","verso","green","blaze","giant","polyp","risen","rowdy","needy","unwed","noisy","gloss","spook","brisk","frock","undid","clack","paint","whine","tuber","saucy","midst","bleat","stave","quack","retro","apnea","groan","video","dally","sonar","helix","noose","weedy","flair","vinyl","irony","adept","taken","whelp","scrum","penne","palsy","juicy","plane","frill","chord","major","mason","house","power","filet","flare","showy","spool","meaty","quake","mayor","rebut","thick","synod","cameo","phony","creed","plumb","clink","parer","kitty","obese","tango","imply","facet","gaffe","meter","brave","agape","burnt","usage","dicey","leach","elate","manic","ovoid","prawn","homer","ester","polka","flint","girly","mango","waver","belie","throw","caput","guide","spoof","local","waist","gloat","joust","plait","magic","crane","vegan","blank","thigh","essay","heady","rabbi","ridge","bread","stool","donor","outdo","boule","equip","death","thyme","moron","tasty","pasty","admit","lapse","roast","piece","chore","extra","sandy","bleed","given","shift","wiser","pluck","graft","stick","chair","canal","lucid","flout","shady","elide","foamy","mafia","shoal","slang","fleet","slyly","smite","might","trend","truck","strip","acorn","qualm","stiff","flank","state","patty","shiny","poker","tense","favor","frond","madam","bayou","kayak","queen","stoop","tally","flock","affix","close","merge","ought","splat","caste","swirl","conic","watch","cling","arrow","loser","dilly","remit","orbit","petal","bound","swoon","shunt","lorry","count","atone","model","prize","creep","ocean","liner","etude","feral","guppy","scowl","peril","color","fruit","penny","madly","rifle","enter","grace","globe","abate","wreck","uncut","linen","grass","golly","azure","islet","crick","press","ideal","droop","avoid","nasal","handy","reign","baler","pithy","phase","savoy","wider","venue","vodka","break","unite","crone","ditch","opera","enemy","spree","sneer","unify","sworn","melee","shark","speck","trash","lupus","biome","spire","above","knife","movie","heart","cress","banjo","tibia","raspy","birch","since","wrung","slosh","itchy","moody","cheat","fleck","clove","broth","birth","lager","topic","asset","grown","tithe","milky","jetty","testy","junta","print","saint","slump","tulle","mania","freak","clock","gloom","pushy","stunk","ardor","cinch","guess","cyber","booth","hefty","motor","froth","usual","rainy","stank","decal","blunt","motto","frisk","caddy","foyer","crypt","racer","budge","lymph","manga","koala","scalp","wight","safer","scour","creme","unset","rigor","cider","cable","hasty","taker","fudge","snoop","mecca","space","value","ferry","waste","forgo","crier","envoy","natal","puree","snuff","ruler","triad","colon","silky","clean","utile","brood","purse","gravy","beefy","leper","niche","dream","ruddy","twixt","limbo","upper","trick","cigar","cease","singe","lyric","tangy","cower","dandy","metal","ionic","vivid","howdy","blend","fluff","welsh","throb","goose","vigil","solid","datum","swath","mover","antic","pearl","blame","tulip","final","fiber","dwell","fanny","stork","quote","raven","stray","quota","fling","gruff","crept","grind","wooer","widow","manly","spill","beret","lefty","argue","sunny","filmy","least","revue","wimpy","grant","aside","cause","sight","three","hunch","tempo","fatty","phone","chafe","renew","gipsy","merry","still","jumpy","steam","booby","alter"]

function getSolution() {
  const a = localStorage.gameState.split('solution')[1];
  return a.slice(a.indexOf(':') + 2, a.indexOf(',') - 1);
}

function type(letters) {
  const ary = letters.toLowerCase().split('');
  ary.forEach(letter => {
    keyElements[letter].click();
  });
}

// 0 through 5
function currentRow() {
  let row = 0;
  // increment row until you get to one that hasn't already been evaluated, that's the one getting typed in
  while (tiles[row][0].getAttribute('evaluation')) {
    row++;
    if (row > 5) return 6;
  }
  return row;
}

// check if an evaluated word contains another of the same tile
function containsSame(rowIdx, idx) {
  const word = gameApp.$board.children[rowIdx].getAttribute('letters');
  const letter = tiles[rowIdx][idx].getAttribute('letter');
  return count(word, letter) > 1;
}

// adds evaluations on the board to the letters array up to the current row
function addEvals(letters) {
  for (let i = 0; i < currentRow(); i++) {
    for (let j = 0; j < 5; j++) {
      const tile = tiles[i][j];
      const eval = tile.getAttribute('evaluation');
      // if it's absent but there's another of the same letter in the word that isn't absent, don't eval as absent
      if (eval == 'absent' && containsSame(i, j)) {
        // do nothing I guess
      } else {
        letters[j][eval].push(tile);
      }
    }
  }
}

function correct() {
  return false;
}

function typeWord(word) {
  type('<<<<<'); // delete anything already typed
  type(word);
  type('>'); // enter
}

// count how many times a letter appears in a word
function count(word, letter) {
  return word.split(letter).length - 1;
}

function calculatePossibleWords(letters) {
  globalAbsent = []; // letters that we know are absent in the whole word
  individualAbsent = [[], [], [], [], []]; // letters we know are absent at a particular spot but in the word somewhere
  correct = ['', '', '', '', '']; // letters we know are correct at a particular spot
  letters.forEach((letter, index) => {
    if (letter['correct'].length > 0) { // if this letter is correct for this spot
      correct[index] = letter['correct'][0].getAttribute('letter');
      return; // skip the iteration, we already know what's correct at this spot
    }
    letter['absent'].forEach(tile => {
      globalAbsent.push(tile.getAttribute('letter'));
    });
    letter['present'].forEach(tile => {
      individualAbsent[index].push(tile.getAttribute('letter'));
    });
  });

  possibleWords = [...words]; // copy words
  // filter for correct letters, only keep if the letter at that index is the correct letter
  possibleWords = possibleWords.filter(word => {
    let keep = true;
    correct.forEach((letter, index) => {
      if (letter == '') return;
      keep = keep && (word[index] == letter);
    });
    return keep;
  });
  // filter out globalAbsent, only keep if the word does NOT contain
  possibleWords = possibleWords.filter(word => {
    let keep = true;
    globalAbsent.forEach(letter => {
      keep = keep && !word.includes(letter);
    });
    return keep;
  });
  // filter for individualAbsent
  possibleWords = possibleWords.filter(word => {
    let keep = true;
    individualAbsent.forEach((spot, index) => {
      spot.forEach(letter => {
        keep = keep && word.includes(letter) && word[index] != letter;
      });
    });
    return keep;
  });

  return possibleWords;
}

function guess() {
  if (currentRow() == 0) {
    typeWord('salet');
    return;
  }

  const letters = [{absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}];
  addEvals(letters);
  const possibleWords = calculatePossibleWords(letters)
  console.log(`guess ${currentRow() + 1} possible words:`, possibleWords);
  typeWord(possibleWords[Math.floor(Math.random() * possibleWords.length)]); // random word from possibleWords
}

const l = [{absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}, {absent: [], present: [], correct: []}];
const gameApp = document.querySelector('game-app');

const keyboardElement = gameApp.$keyboard.$keyboard.children;
const keyElements = {};

// get all the elements for the keys at the bottom of the page into keyElements
for (let i = 0; i < keyboardElement.length; i++) {
  const row = keyboardElement[i].children;
  for (let j = 0; j < row.length; j++) {
    const key = row[j];
    const attr = key.getAttribute('data-key'); // will be the letter of the key e.g. 'q' if it is a key, null otherwise
    if (attr) keyElements[attr] = key;
    if (attr == '←') keyElements['<'] = key; // backspace is <
    if (attr == '↵') keyElements['>'] = key; // enter is >
  }
}

const boardElement = gameApp.$board.children;
const tiles = [];

for (let i = 0; i < boardElement.length; i++) {
  tiles[i] = [];
  const row = boardElement[i].$row.children;
  for (let j = 0; j < row.length; j++) {
    tiles[i][j] = row[j];
  }
}

const guessBtn = document.createElement('button');
guessBtn.style.width = '200px';
guessBtn.style.height = '50px';
guessBtn.style.position = 'absolute';
guessBtn.style.top = '90px';
guessBtn.style.left = '50%';
guessBtn.style.marginLeft = '-100px';
guessBtn.textContent = 'GUESS';
guessBtn.style.fontSize = '20px';
guessBtn.style.borderRadius = '0';
guessBtn.onclick = guess;
document.body.appendChild(guessBtn);
